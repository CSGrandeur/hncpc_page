var page_info_input=$("#page_info_input");var ranklist_toobar=$("#ranklist_toobar");var ranktable=$("#ranklist_table");var school_filter=$("#school_filter");var schoolDict=[];var schoolFilterCookieName="contest_school_filter_"+page_info_input.attr("cid");var school_filter_all=$("#school_filter_all"),school_filter_none=$("#school_filter_none");var autoRefreshInterval=20;var ac_color_to_chose=["#90ee90","#f9f3a1"];var ac_color=ac_color_to_chose[0];var table_div=$("#ranklist_table_div");var auto_refresh_time_span=$("#auto_refresh_time");var auto_refresh_time=autoRefreshInterval;var auto_refresh_time_timeout;function str0(a){if(a<10){return"0"+a}else{return a}}function clock(h){var o,q,d,r,m,p,n;var l=new Date(new Date().getTime()+h);m=l.getFullYear();p=str0(l.getMonth()+1);n=str0(l.getDate());o=str0(l.getHours());q=str0(l.getMinutes());d=str0(l.getSeconds());r=m+"-"+p+"-"+n+" "+o+":"+q+":"+d;$("#current_time").text(r);setTimeout(function(){clock(h)},1000)}function update_time(b){diff=new Date(b["current_time"]*1000).getTime()-new Date().getTime();clock(diff);$("#start_time").text(b["start_time"]);$("#end_time").text(b["end_time"]);$("#contest_status").text(b["contest_status"])}function update_table_head(e,f){page_type=page_info_input.attr("page-type");columns=[];columns.push({field:"rank",align:"center",valign:"middle",sortable:"true",sorter:"rankSorter",width:"60",cellStyle:"rankCellStyle",title:"Rank"});if(page_type=="teamrank"){columns.push({field:"user_id",align:"left",valign:"middle",sortable:"true",width:"100",title:"ID"});columns.push({field:"nick",align:"left",valign:"middle",sortable:"true",width:"100",cellStyle:"nickCellStyle",title:"Team Name"})}else{columns.push({field:"school",align:"center",valign:"middle",sortable:"true",width:"180",cellStyle:"schoolCellStyle",title:"School"})}columns.push({field:"solved",align:"center",valign:"middle",sortable:"false",width:"60",title:"Solved"});columns.push({field:"penalty",align:"center",valign:"middle",sortable:"false",width:"80",title:"Penalty"});for(var d=0;d<e["problem_num"];d++){columns.push({field:String.fromCharCode(65+d),align:"center",valign:"middle",sortable:"false",width:"90",cellStyle:"acCellStyle",title:String.fromCharCode(65+d)})}if(page_type=="teamrank"){columns.push({field:"school",align:"left",valign:"middle",sortable:"false",width:"80",cellStyle:"schoolCellStyle",title:"School"});columns.push({field:"member",align:"left",valign:"middle",sortable:"false",width:"80",cellStyle:"memberCellStyle",title:"Member"})}else{columns.push({field:"topteam",align:"left",valign:"middle",sortable:"false",width:"80",cellStyle:"topteamCellStyle",title:"Top Team"})}f.bootstrapTable({toggle:"table",url:data_source,method:"GET",sidePagination:"client",striped:"true",showRefresh:"true",silentSort:"false",buttonsAlign:"left",toolbarAlign:"left",sortStable:"true",showExport:"true",toolbar:"#ranklist_toobar",exportTypes:"['excel', 'json', 'png']",exportOptions:"{'fileName':'teamrank'}",columns:columns})}$(document).ready(function(){$.ajax({url:"config.json",success:function(b){update_time(b);$("#contest_title").text(b["contest_title"]);update_table_head(b,ranktable)},type:"GET",dataType:"json",cache:false})});ranktable.on("load-success.bs.table",function(g,h){if(typeof(h)!="undefined"){schoolDict=[];for(var e=0;e<h.length;e++){if(typeof(h[e]["school"])!="undefined"){var f=$.trim(h[e]["school"]);if(f!=""){schoolDict[h[e]["school"]]=true}}}UpdateSchoollistFromCookie();UpdateSchoolFilter();UpdateFilterSchoolRank()}});function UpdateSchoollistFromCookie(){var g=$.cookie(schoolFilterCookieName);if(typeof(g)!="undefined"){try{var e=JSON.parse(g);for(var f in schoolDict){schoolDict[f]=e.indexOf(f)>-1}}catch(h){}}}function UpdateSchoollistCookie(){$.cookie(schoolFilterCookieName,JSON.stringify(school_filter.val()),{expires:1})}school_filter_all.on("click",function(){school_filter.selectpicker("selectAll")});school_filter_none.on("click",function(){school_filter.selectpicker("deselectAll")});school_filter.on("change",function(b){UpdateFilterSchoolRank();UpdateSchoollistCookie()});function UpdateSchoolFilter(){school_filter.empty();var f=[];var e=[];for(var h in schoolDict){if(schoolDict[h]==true){f.push(h)}e.push(h)}e.sort();for(var g=0;g<e.length;g++){school_filter.append("<option>"+e[g]+"</option>")}school_filter.selectpicker("val",f);school_filter.selectpicker("refresh")}function UpdateFilterSchoolRank(){var c=school_filter.val();for(var d in schoolDict){schoolDict[d]=c.indexOf(d)>-1}ranktable.bootstrapTable("filterBy",{"school":c})}ranktable.on("post-body.bs.table",function(){if(ranktable[0].scrollWidth>table_div.width()){table_div.width(ranktable[0].scrollWidth+20)}});$(window).keydown(function(b){if(b.keyCode==116&&!b.ctrlKey){if(window.event){try{b.keyCode=0}catch(b){}b.returnValue=false}b.preventDefault();ranktable.bootstrapTable("refresh")}});var color_blind_mode_box=$("#color_blind_mode_box");var auto_refresh_box=$("#auto_refresh_box");$(document).ready(function(){color_blind_mode_box.bootstrapSwitch();
auto_refresh_box.bootstrapSwitch();auto_refresh_time_span.text(auto_refresh_time);if($.cookie("color_blind_mode")){var d=$.trim($.cookie("color_blind_mode"));if(d=="true"){color_blind_mode_box.bootstrapSwitch("state",true,true);ac_color=ac_color_to_chose[1]}else{color_blind_mode_box.bootstrapSwitch("state",false,false);ac_color=ac_color_to_chose[0]}}if($.cookie("auto_refresh_box")){var c=$.trim($.cookie("auto_refresh_box"));if(c=="true"){auto_refresh_box.bootstrapSwitch("state",true,true)}else{auto_refresh_box.bootstrapSwitch("state",false,true)}}if(auto_refresh_box.bootstrapSwitch("state")){setTimeout(function(){RefreshTable()},autoRefreshInterval)}});auto_refresh_box.on("switchChange.bootstrapSwitch",function(d,c){if(c==true){RefreshTable();$.cookie("auto_refresh_box","true")}else{auto_refresh_time=autoRefreshInterval;auto_refresh_time_span.text(auto_refresh_time);clearTimeout(auto_refresh_time_timeout);$.cookie("auto_refresh_box","false")}});function RefreshTable(){auto_refresh_time--;if(auto_refresh_time<=0){ranktable.bootstrapTable("refresh");auto_refresh_time=autoRefreshInterval}auto_refresh_time_span.text(pad0left(auto_refresh_time,2,"0"));if(auto_refresh_box.bootstrapSwitch("state")){auto_refresh_time_timeout=setTimeout(function(){RefreshTable()},1000)}}color_blind_mode_box.on("switchChange.bootstrapSwitch",function(d,c){if(c==true){ac_color=ac_color_to_chose[1];$.cookie("color_blind_mode","true")}else{ac_color=ac_color_to_chose[0];$.cookie("color_blind_mode","false")}ranktable.bootstrapTable("load",ranktable.bootstrapTable("getOptions").data)});function rankSorter(a,g){var b=Number($(a).text());var h=Number($(g).text());if(b>h){return 1}if(b<h){return -1}return 0}var wa_color="#ee9090";var first_blood_color="#69b2f1";function acCellStyle(j,h,f){var i="",g=$(j);if(g.attr("pstatus")==1){i=wa_color}else{if(g.attr("pstatus")==2){i=ac_color}else{if(g.attr("pstatus")==3){i=first_blood_color}}}return{css:{"background-color":i,"min-width":"75px"}}}function rankSorter(a,g){var b=Number($(a).text());var h=Number($(g).text());if(b>h){return 1}if(b<h){return -1}return 0}function rankCellStyle(l,j,n){if($(l).attr("acforprize")=="0"){return{css:{"background-color":""}}}var m=$(l).text();var r="";var k=ranktable.bootstrapTable("getOptions").data.length;var p=Math.ceil(k*0.1-1e-7);var o=p+Math.ceil(k*0.15-1e-7);var q=o+Math.ceil(k*0.2-1e-7);if(m<=p){r="gold"}else{if(m<=o){r="slategray"}else{if(m<=q){r="darkcyan"}}}return{css:{"background-color":r}}}function nickCellStyle(d,f,e){return{css:{"min-width":"150px"}}}function schoolCellStyle(d,f,e){return{css:{"min-width":"180px"}}}function memberCellStyle(d,f,e){return{css:{"min-width":"300px"}}};